window.__require=function e(t,i,c){function o(a,n){if(!i[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!n&&l)return l(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){return o(t[a][1][e]||e)},h,h.exports,e,t,i,c)}return i[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<c.length;a++)o(c[a]);return o}({ball:[function(e,t){"use strict";cc._RF.push(t,"d3b84xoHmBDprXmttQkjrwR","ball");cc.Class({extends:cc.Component,properties:{speed:500,direction:0,_dir:cc.Vec2.ZERO,_state:"ALIVE"},onLoad:function(){this.collider=this.node.getComponent(cc.BoxCollider),this.node._type="ball",this._dir.equals(cc.Vec2.ZERO)&&(this._dir=cc.Vec2.RIGHT.rotate(this.direction*Math.PI/180).normalize()),this.moveDelta=1/60},start:function(){},isAlive:function(){return"ALIVE"==this._state},move:function(){var e=this._dir.mul(this.moveDelta*this.speed);this.node.x+=e.x,this.node.y+=e.y},isBelow:function(e,t){return e.y+e.height<=t.y},isAbove:function(e,t){return e.y>=t.y+t.height},isLeft:function(e,t){return e.x+e.width<=t.x},isRight:function(e,t){return e.x>=t.x+t.width},onCollisionEnter:function(e,t){var i=t.world,c=(i.aabb,i.preAabb,cc.Vec2.RIGHT.signAngle(this._dir));if("wall"==e.node._coll_type||"brick"==e.node._coll_type||"player"==e.node._coll_type||"bottomWall"==e.node._coll_type)if("brick"==e.node._coll_type&&cc.soulbaka.game.isOnFire());else{var o=t.world.preAabb,s=e.world.aabb;if(this._dir.y>0&&this.isBelow(o,s)?this._dir=cc.Vec2.RIGHT.rotate(2*Math.PI-c):this._dir.y<0&&this.isAbove(o,s)?this._dir=cc.Vec2.RIGHT.rotate(2*Math.PI-c):this._dir.x>0&&this.isLeft(o,s)?this._dir=cc.Vec2.RIGHT.rotate(1*Math.PI-c):this._dir.x<0&&this.isRight(o,s)&&(this._dir=cc.Vec2.RIGHT.rotate(3*Math.PI-c)),"player"==e.node._coll_type){var a=180*cc.Vec2.RIGHT.signAngle(this._dir)/Math.PI;a<18&&a>0?this._dir.rotateSelf(15*Math.PI/180):a<180&&a>162?this._dir.rotateSelf(-15*Math.PI/180):this._dir=this._dir.rotate((Math.random()>.5?1:-1)*Math.random()*25*Math.PI/180)}}"bottomWall"==e.node._coll_type&&(this._state="DEAD",cc.soulbaka.game.checkWinLose(),this.node.active=!1),"brick"==e.node._coll_type&&("1"==e.node._data||Math.random()<.1&&"0"==e.node._data)&&cc.soulbaka.game.generateItem(e.node.x,e.node.y),"brick"==e.node._coll_type&&(cc.soulbaka.game.increaseScore(),cc.soulbaka.game.showDrop(e.node.parent.convertToWorldSpaceAR(e.node.position)),e.node.active=!1,cc.soulbaka.game.checkWinLose())},onCollisionStay:function(){},onCollisionExit:function(){}}),cc._RF.pop()},{}],game:[function(e,t){"use strict";cc._RF.push(t,"4eb36g/ZoNHZKLfy4tzBvTy","game");var i=e("./ball"),c=e("./item");cc.Class({extends:cc.Component,properties:{player:cc.Node,balls:{type:[i],default:[]},items:{type:[cc.Node],default:[]},bricks:{type:[cc.Node],default:[]},walls:{type:[cc.Node],default:[]},drops:{type:[cc.Node],default:[]},touchNode:cc.Node,uiNode:cc.Node,_score:0,_showScore:0,_lv:1,_state:"IDLE",_fireballTime:0,_speedballTime:0,_clickCallback:null,_clickData:null},onLoad:function(){this.walls.forEach(function(e){"wall_bottom"==e.name?e._coll_type="bottomWall":e._coll_type="wall"}),this.player._coll_type="player",this.touchNode.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation();cc.log(t),this.isRunning()&&(this.player.x=this.player.parent.convertToNodeSpaceAR(t).x),"IDLE"==this._state&&this.startGame()},this),this.touchNode.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation();this.isRunning()&&(this.player.x=this.player.parent.convertToNodeSpaceAR(t).x)},this),this._state="IDLE",this.resetGame()},start:function(){var e=this;this.showMenu("Go North!","","START",function(){e.load(e._lv),e.player.active=!0,e.balls[0].node.active=!0,cc.find("score",e.uiNode).active=!0})},resetGame:function(){this.player.x=0,this.player.y=-420,this.player.width=130,this.player.getComponent(cc.BoxCollider).size.width=130,this.player.active=!1,this.balls.forEach(function(e,t){0==t?(e.node.x=0,e.node.y=-378,e.node.active=!1,e._state="ALIVE",e._dir=cc.Vec2.RIGHT.rotate((e.direction+20*Math.random()*(Math.random()<.5?1:-1))*Math.PI/180).normalize(),cc.find("fire",e.node).active=!1):e.node.destroy()}),this.balls=[this.balls[0]],this.items.forEach(function(e){e.destroy()}),this.items.length=0,this.drops.forEach(function(e){e.stopAllActions(),e.destroy()}),this.drops.length=0,cc.find("score",this.uiNode).active=!1,this._showScore=this._score,cc.soulbaka.main.toNormalSpeed(),this._fireballTime=0,this._speedballTime=0,cc.find("buffs/fire",this.uiNode).active=!1,cc.find("buffs/windy",this.uiNode).active=!1},startGame:function(){this.player.active=!0,this.balls[0].node.active=!0,cc.find("score",this.uiNode).active=!0,this._state="RUNNING"},isRunning:function(){return"RUNNING"==this._state},isWin:function(){return"WIN"==this._state},isLose:function(){return"LOSE"==this._state},step:function(){this.balls&&this.balls.forEach(function(e){e.isAlive()&&e.move()}),this.items&&this.items.forEach(function(e){var t=e.getComponent(c);t.isAlive()&&t.move()})},isOnFire:function(){return this._fireballTime>0},increaseFire:function(){var e=this._fireballTime;this._fireballTime+=10,cc.find("buffs/fire/img",this.uiNode).stopAllActions(),cc.find("buffs/fire/img",this.uiNode).runAction(cc.sequence(cc.scaleTo(.16,2,2),cc.scaleTo(.16,1,1))),e<=0&&(cc.find("buffs/fire",this.uiNode).active=!0,this.balls.forEach(function(e){e.isAlive()&&(cc.find("fire",e.node).active=!0)}))},rainDropBall:function(){var e=this,t=[];this.balls.forEach(function(c){if(c.isAlive()){for(var o=0,s=2,a=c._dir.rotate(Math.PI/6),n=c._dir.rotate(-Math.PI/6),r=0;r<e.balls.length;r+=1)if(!e.balls[r].isAlive()&&-1==t.indexOf(e.balls[r])){var l=e.balls[r];t.push(l),l.node.x=c.node.x,l.node.y=c.node.y;var h=a.lerp(n,(o<Math.floor(2)/2?o:o+1)/2);l._dir=h,s-=1,o+=1}for(var d=0;d<s;d+=1){var u=cc.instantiate(e.balls[0].node).getComponent(i);u.node.parent=c.node.parent,u.node.__isNewBall=!0,t.push(u),u.node.x=c.node.x,u.node.y=c.node.y;var f=a.lerp(n,(o<Math.floor(2)/2?o:o+1)/2);u._dir=f,o+=1}}}),t.forEach(function(t){t.node.__isNewBall&&(t.node.__isNewBall=null,e.balls.push(t)),t._state="ALIVE",t.node.active=!0,e.isOnFire()&&(cc.find("fire",t.node).active=!0)})},growthKey:function(){this.player.width+=30,this.player.getComponent(cc.BoxCollider).size.width+=30},windyAll:function(){var e=this._speedballTime;this._speedballTime+=10,cc.find("buffs/windy/img",this.uiNode).stopAllActions(),cc.find("buffs/windy/img",this.uiNode).runAction(cc.sequence(cc.scaleTo(.16,2,2),cc.scaleTo(.16,1,1))),e<=0&&(cc.find("buffs/windy",this.uiNode).active=!0,cc.soulbaka.main.toSpeed(1))},update:function(e){"PAUSE"!=this._state&&(this._showScore<this._score&&(this._showScore+=17,this._showScore>this._score&&(this._showScore=this._score),cc.find("score/data",this.uiNode).getComponent(cc.Label).string=this._showScore),this._fireballTime>0&&"RUNNING"==this._state&&(this._fireballTime-=e,cc.find("buffs/fire/sec",this.uiNode).getComponent(cc.Label).string=Math.round(this._fireballTime),this._fireballTime<=0&&(this._fireballTime=0,cc.find("buffs/fire",this.uiNode).active=!1,this.balls.forEach(function(e){e.isAlive()&&(cc.find("fire",e.node).active=!1)}))),this._speedballTime>0&&"RUNNING"==this._state&&(this._speedballTime-=e,cc.find("buffs/windy/sec",this.uiNode).getComponent(cc.Label).string=Math.round(this._speedballTime),this._speedballTime<=0&&(this._speedballTime=0,cc.soulbaka.main.toNormalSpeed(),cc.find("buffs/windy",this.uiNode).active=!1)))},checkWinLose:function(){var e=this;return this.balls.every(function(e){return!e.isAlive()})?(this._state="LOSE",void this.showMenu("Go North!","GAME OVER","restart?",function(){e._state="IDLE",e.resetGame(),e._lv=1,e.load(e._lv),e.player.active=!0,e.balls[0].node.active=!0,e._score=0,e._showScore=e._score,cc.find("score",e.uiNode).active=!0,cc.find("score/data",e.uiNode).getComponent(cc.Label).string=e._score})):this.bricks.every(function(e){return!e.active})?(this._state="WIN",void(this._lv<5?this.showMenu("Go North!","YOU WIN","next level",function(){e._state="IDLE",e.resetGame(),e._lv+=1,e.load(e._lv),e.player.active=!0,e.balls[0].node.active=!0,cc.find("score",e.uiNode).active=!0}):this.showMenu("Go North!","YOU WIN","restart?",function(){e._state="IDLE",e.resetGame(),e._lv=1,e.load(e._lv),e.player.active=!0,e.balls[0].node.active=!0,cc.find("score",e.uiNode).active=!0}))):void 0},increaseScore:function(){this._score+=100},showDrop:function(e,t,i){i=i||Math.floor(cc.soulbaka.main.dropSprites.length*Math.random());var c=cc.instantiate(cc.soulbaka.main.dropSprites[i].node);this.drops.push(c),c.parent=this.uiNode;var o=c.parent.convertToNodeSpaceAR(cc.Vec2(e,t));c.x=o.x,c.y=o.y,c.opacity=0,c.stopAllActions(),c.runAction(cc.sequence(cc.fadeTo(.1,255),cc.bezierTo(.7,[cc.v2(o.x,o.y+80),cc.v2(o.x,o.y-200),cc.find("score",this.uiNode).position]),cc.fadeTo(.05,0),cc.callFunc(function(){cc.find("score/coin",this.uiNode).stopAllActions(),cc.find("score/coin",this.uiNode).runAction(cc.sequence(cc.scaleTo(.16,2,2),cc.scaleTo(.16,1,1))),c.destroy()}.bind(this))))},generateItem:function(e,t,i){i=i||Math.floor(4*Math.random());var o=cc.instantiate(cc.soulbaka.main.itemSprites[i].node);this.items.push(o),o.parent=cc.find("Canvas"),o.addComponent(c).setup(e,t,i)},load:function(e){var t="map/lv"+Math.floor(e);this.bricks.forEach(function(e){e.destroy()}),this.bricks.length=0,cc.resources.load(t,function(e,t){var i=this;cc.log(t.text),t.text.split("\n").forEach(function(e,t){(e=e.trim()).split(",").forEach(function(e,c){i.generateByData(e,t,c)})})}.bind(this))},generateByData:function(e,t,i){var c=49*i-294+24,o=49*-t-36+this.walls[2].y;if("0"==e){var s=cc.instantiate(cc.soulbaka.main.boxSprites[0].node);s.parent=cc.find("Canvas"),s.width=48,s.height=48;var a=s.addComponent(cc.BoxCollider);a.size.width=48,a.size.height=48,s.group="brick",s._coll_type="brick",s._data=e,s.name="brick_"+i+"_"+t,s.x=c,s.y=o,this.bricks.push(s)}if("1"==e){var n=cc.instantiate(cc.soulbaka.main.boxSprites[0].node);n.parent=cc.find("Canvas"),n.width=48,n.height=48;var r=n.addComponent(cc.BoxCollider);r.size.width=48,r.size.height=48,n.group="brick",n._coll_type="brick",n._data=e,n.name="brick_"+i+"_"+t,n.x=c,n.y=o,this.bricks.push(n)}},showMenu:function(e,t,i,c,o){cc.find("tips",this.uiNode).active=!0,cc.find("tips/title",this.uiNode).getComponent(cc.Label).string=e,cc.find("tips/text",this.uiNode).getComponent(cc.Label).string=t,cc.find("tips/choice/bg/text",this.uiNode).getComponent(cc.Label).string=i,this._clickCallback=c,this._clickData=o},clickChoice:function(){this._clickCallback&&(this._clickCallback(this._clickData),cc.isValid(this.uiNode)&&cc.isValid(cc.find("tips",this.uiNode))&&(cc.find("tips",this.uiNode).active=!1))}}),cc._RF.pop()},{"./ball":"ball","./item":"item"}],item:[function(e,t){"use strict";cc._RF.push(t,"311209pJvVAaa6Tn1X2HCCn","item");cc.Class({extends:cc.Component,properties:{speed:300,_type:-1,_dir:cc.Vec2.RIGHT,_state:"ALIVE"},onLoad:function(){this.collider=this.node.getComponent(cc.BoxCollider),this.node._type="item",this._dir=cc.Vec2.RIGHT.normalize().rotate(-Math.PI/2)},start:function(){},isAlive:function(){return"ALIVE"==this._state},setup:function(e,t,i){this.node.x=e,this.node.y=t,this.node.group="drop",this._type=i,this.node.addComponent(cc.BoxCollider)},move:function(){this.moveDelta=1/(60/cc.soulbaka.main._frameRate);var e=this._dir.mul(this.moveDelta*this.speed);this.node.x+=e.x,this.node.y+=e.y},onCollisionEnter:function(e){if("player"==e.node._coll_type){switch(cc.log(this._type),this._type){case-1:break;case 0:cc.soulbaka.game.increaseFire();break;case 1:cc.soulbaka.game.rainDropBall();break;case 2:cc.soulbaka.game.growthKey();break;case 3:cc.soulbaka.game.windyAll()}this.node.active=!1}"bottomWall"==e.node._coll_type&&(this.node.active=!1)},onCollisionStay:function(){},onCollisionExit:function(){}}),cc._RF.pop()},{}],main:[function(e,t){"use strict";cc._RF.push(t,"126a5o6kzhAfZkZ8ZNAWz1f","main");var i=e("./game");cc.Class({extends:cc.Component,properties:{_frameCnt:0,_frameRate:2,game:{type:i,default:null},itemSprites:{type:[cc.Sprite],default:[]},boxSprites:{type:[cc.Sprite],default:[]},dropSprites:{type:[cc.Sprite],default:[]}},onLoad:function(){cc.soulbaka=cc.soulbaka||{},cc.soulbaka.main=this,this._frameCnt=0,this._frameRate=2,cc.director.getCollisionManager().enabled=!0},start:function(){cc.soulbaka.game=this.game},update:function(){this._frameCnt+=1,this._frameCnt%this._frameRate==0&&this.game&&this.game.isRunning()&&this.game.step()},toNormalSpeed:function(){this._frameRate=2},toSpeed:function(e){this._frameRate=Math.floor(e)||1}}),cc._RF.pop()},{"./game":"game"}]},{},["ball","game","item","main"]);